# Instructions

This folder contains benchmarks based on PyPSA and PyPSA-Eur. The benchmarks can be generated by following these steps:

1. Install Docker on your machine.

1. Build and run the docker container containing all the dependencies to generate the benchmarks:
     ```sh
     cd solver-benchmark/benchmarks/pypsa/
     docker build .
     docker run -it --entrypoint bash <image-hash-from-previous-output>
     ```

1. Inside the docker container, run the benchmark generating script:
     ```sh
     micromamba activate benchmark-gen
     cd pypsa-eur
     ./solver-benchmarks/generate-sizes.sh <benchmark-name> /tmp/
     ```
     where `<benchmark-name>` is one of:
     ```
     pypsa-eur-sec
     pypsa-eur-elec-trex
     pypsa-eur-elec-op
     pypsa-eur-elec-op-ucconv
     ```
     To generate the plain pypsa benchmarks, run:
     ```sh
     python ./solver-benchmarks/pypsa-gas+wind+sol+ely-1-1h.py
     python ./solver-benchmarks/pypsa-gas+wind+sol+ely-ucgas-1-1h.py
     ```

The benchmarks can be found in `/tmp/pypsa*.lp` inside the docker container.

### Zenodo Integration

To install the zenodopy package from the specific branch, use the following command:

```sh
pip install git+https://github.com/drifter089/zenodopy.git@basic_test#egg=zenodopy
```
update the Zenodo deposition by running the *benchmarks/pypsa/zenodo_update.py* script with the following arguments:

- `--version_tag`: The version tag for the new release.
- `--zenodo_token`: The Zenodo API token.
- `--dep_id`: The Zenodo deposition ID.
- `--metadata_file`: The metadata JSON file path.
- `--upload_dir`: The directory containing files to upload.

Example command:

```sh
python benchmarks/pypsa/zenodo_update.py \
  --version_tag "<version_tag>" \
  --zenodo_token "<zenodo_token>" \
  --dep_id "<dep_id>" \
  --metadata_file "<metadata_file_path>" \
  --upload_dir "<upload_directory>"
```